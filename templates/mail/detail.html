{% extends "topic/base.html" %}
{% block title %}站内信{% endblock %}
{% block main %}
    <div id="main">
        <div id="sidebar">

            <div class="panel">
                <div class="header">
                    <span class="col_fade">个人信息</span>
                </div>
                <div class="inner">
                    <div class="user_card">

                        <a class="user_avatar" href="{{ url_for('index.profile') }}">
                            <img src="{{ user.image }}">
                        </a>
                        <span class="user_name"><a class="dark"
                                                   href="{{ url_for('index.profile') }}">{{ user.username }}</a></span>

                        <div class="space clearfix"></div>
                        <span class="signature">
                               {{ user.signature }}
                            </span>
                    </div>
                </div>
            </div>
        </div>

        <div id="content">
            <div class="panel">
                <div class="header">
                    <span class="col_fade">站内信</span>
                </div>
                <div class="inner">
                    <div>
                        <div class="control-group">
                            <label class="control-label" for="id">发件人：</label>
                            <a class="user_avatar pull-left" href="{{ url_for('index.user_detail', id=message.sender_id) }}">
                                <img src={{ message.sender().image }}>
                            </a>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span>{{ message.sender().username }}</span>


                        </div>
                    </div>
                </div>

                <div class="inner">
                    <div>
                        <div class="control-group">
                            <label class="control-label" for="id">收件人：</label>
                            <a class="user_avatar pull-left" href="{{ url_for('index.user_detail', id=message.receiver_id) }}">
                                <img src={{ message.receiver().image }}>
                            </a>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span>{{ message.sender().username }}</span>

                        </div>
                    </div>
                </div>

                <div class="inner">
                    <div>
                        <div class="control-group">
                            <label class="control-label" for="id">标题：</label>
                            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ message.title }}</span>
                            <br>
                            <br>
                            <label class="control-label" for="id">内容：</label>
                            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ message.content }}</span>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/static/js/prism.js"></script>
<script src="https://cdn.bootcss.com/marked/0.3.19/marked.min.js"></script>
<script src="https://cdn.bootcss.com/prism/1.13.0/prism.js"></script>
<script src="https://cdn.bootcss.com/prism/1.13.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script>
    var e = function (sel) {
        return document.querySelector(sel)
    }

    var es = function (sel) {
        return document.querySelectorAll(sel)
    }

    var markContents = function () {
        // markdown -> html 的处理放在高亮前面
        // 因为高亮是针对 html 格式的
        // lang -> language 不需要转 prism 自动转了
        var contentDivs = es('.markdown-text')
        for (var i = 0; i < contentDivs.length; i++) {
            var contentDiv = contentDivs[i]
            console.log('pre marked', contentDiv.textContent)
            var content = marked(contentDiv.textContent)
            console.log('after marked', content)
            contentDiv.innerHTML = content
        }
    }

    var highlight = function() {
         // 自动加载对应的语言 不然要手动加入各个语言的 js
        Prism.plugins.autoloader.languages_path = 'https://cdn.bootcss.com/prism/1.13.0/components/'
    }

    var __main = function () {
        markContents()
        highlight()
    }

    __main()

</script>

{% endblock %}